<br>
<br><br><br><br><br><br>

<% @response["response"]["venues"].each do |response| %>
  <%= response["name"] %>
  <br/>
  <%= response["location"]["lat"] %> ,
  <%= response["location"]["lng"] %>
  <br/>
<% end %>

<div id="map"></div>

    <div id="venues"></div>

<% if !signed_in? %>
  <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
      <header class="masthead mb-auto">
      </header>

      <main role="main" class="inner cover">
        <h1 class="cover-heading">Warbase</h1>
        <br>
        <h2 class="lead">Take over the city!</h3> <br>
          <%= button_to 'Sign in',  new_user_session_path, method: :get, class: "btn btn-primary" %>
      </main>

      <footer class="mastfoot mt-auto">
      </footer>
</div>

<% else %>
<br/>
<br/>
<p id="notice"><%= notice %></p>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV["GOOGLE"] %>&callback=initMap"
    async defer></script>

<script>
  

let map, infoWindow;
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 40.707984, lng: -74.006486},
    zoom: 19
  });
infoWindow = new google.maps.InfoWindow;
}
// Try HTML5 geolocation.
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(function(position) {
    var pos = {
      lat: position.coords.latitude,
      lng: position.coords.longitude
    };
    let latlng = new google.maps.LatLng(pos.lat, pos.lng);
    var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title: "Hey it's <%=@user.username%>!"
        });

    axios.get("https://api.foursquare.com/v2/venues/explore?ll="+pos.lat+","+pos.lng+"&client_id=<%=@foursquare_id%>&client_secret=<%=@foursquare_secret%>&v=20130619")
    .then(function (response) {
      let data = response.data.response.groups[0].items
      // console.log(response.data.response.groups[0].items[0].venue.name);
      // console.log(response.data.response.groups[0].items[0].venue.location.lat);
      // console.log(response.data.response.groups[0].items[0].venue.location.lng);
      // console.log(response.data.response.groups[0].items[1].venue.name);

      console.log(data.length)
      for(let i = 0; i < data.length; i++){
        let latlng = new google.maps.LatLng(data[i].venue.location.lat, data[i].venue.location.lng);
        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title: data[i].venue.name
        });
        console.log(latlng)
        console.log(data[i].venue.name)
        marker.setMap(map);
      }
        

    })
    .catch(function (error) {
      console.log(error);
    });

    infoWindow.setPosition(pos);
    infoWindow.setContent('Found you!');
    infoWindow.open(map);
    map.setCenter(pos);
  }, function() {
    handleLocationError(true, infoWindow, map.getCenter());
  });
} else {
  // Browser doesn't support Geolocation
  handleLocationError(false, infoWindow, map.getCenter());
}


function handleLocationError(browserHasGeolocation, infoWindow, pos) {
infoWindow.setPosition(pos);
infoWindow.setContent(browserHasGeolocation ?
                      'Error: The Geolocation service failed.' :
                      'Error: Your browser doesn\'t support geolocation.');
infoWindow.open(map);

}
</script>

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
<h1>Home</h1>
  <!--<div style='width: 800px;'>
    <div id="geolocation" style='width: 800px; height: 400px;'></div>
  </div> -->
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <section class="table-responsive">
    </section>
  </div>
</main>

<% end %>

